Coding
======

Formatting
----------

This project follows the [PEP8](https://www.python.org/dev/peps/pep-0008/)
style guide for all Python code. Flake8 is run alongside other tests on our
CI server at every commit to ensure compliance, however, we do allow some leeway
on how strict the enforcement is - see below for a list of ignored Flake8 errors.

As [A Foolish Consistency is the Hobgoblin of Little Minds](https://www.python.org/dev/peps/pep-0008/#id10), 
the `# noqa` comment may be freely added to a line to skip validation where
necessary if flake8 is trying to ruin your latest masterpiece (for example,
in Python code generated by Protobuf).

We recommend anyone committing code to setup a flake8 pre-commit hook.

**TODO:** UTF-8 source files - header (`# coding=utf-8`)?
**TODO:** import/__author__ ordering
**TODO:** explicit relative imports (from . import relative_module)

**TODO:** Python 3 port/compatibility guide
  * `from __future__ import print_function, absolute_import, division`
  * **TODO:** Discuss use of six/future/past - perhaps save for future (when
    twisted actually supports py3)? Would be best to ensure compatibility from
    earliest point, but unable to actually test until Py3 becomes a viable
    target.
  * What about `unicode_literals`? I suggest against using it as it makes it
    impossible to enter a native string type - you can only specify unicode (by
    default) or byte (with prefix). I suggest using unicode prefix whenever
    possible instead. Generally, we always want unicode strings, but we
    shouldn't do it at the expense of making native strings awkward to use, as
    they're required by some things.

### Ignored errors

* Errors from the `flake8` base package:
    * Code complexity is not checked.
    * `E265`: Block comment should start with `# ` (That is to say, a space must follow the `#`).
    * `E402`: Module level import not at top of file.
    * `F403`: `from module import *` used; unable to detect undefined names .
    * `F841`: Local variable `name` is assigned to but never used.
    * `T000`: TODO note found.
* Errors from `flake8-docstrings` (PEP257), if installed:
    * `D200`: One-line docstring should fit on one line with quotes.
    * `D201`: No blank lines allowed before function docstring.
    * `D202`: No blank lines allowed after function docstring.
    * `D203`: One blank line required before class docstring.
    * `D204`: One blank line required after class docstring.
    * `D205`: One blank line required between summary and field description.
    * `D206`: Docstring should be indented with spaces, not tabs.
    * `D207`: Docstring is under-indented.
    * `D208`: Docstring is over-indented.
    * `D209`: Multi-line docstring closing quotes should be on a separate line.
    * `D210`: No whitespace allowed surrounding docstring text.
    * `D211`: No blank lines allowed before class docstring.
    * `D300`: Use `"""triple double quotes"""`.
    * `D301`: Use `r"""` if any backslashes in a docstring.
    * `D302`: Use `u"""` for Unicode docstrings.
    * `D400`: First line should end with a period.
    * `D401`: First line should be in imperative mood.
    * `D402`: First line should not be the function's "signature".

Structure
---------

For a more complete understanding of any particular module, we suggest checking
out the API docs, or scanning over the source code, but below is a simple
high-level overview of the entire system.

**TODO:** This

* `system` - All core submodules live here
    * `command_manager` - Command-handling
    * `event_manager` - Event-related
    * `factory` - Factory instances handle one Protocol instance each
    * `factory_manager` - Manages Factory instances
    * `logging` - Logging subsystem (check docs for more info)
    * `metrics` - Handles collecting and sending usage data
    * `protocols` - Protocol definition parent module
      * `generic` - Generic protocol types for custom protocols to subclass
        * `protocol` - Main `Protocol` class. All protocols must subclass this.
        * `channel` - Main `Channel` class. All protocols must subclass this.
        * `user` - Main `User` class.  All protocols must subclass this.
      * `<protocol type>` - Provides a custom `Protocol` and related types. 
* `plugins` - Base module for all plugins
* `lib` - External libraries that we can't get from PyPI
* `utils` - Arguably the home of too many things. Generic standalone helper
            functions that would otherwise be littered around other parts of
            the codebase belong here.